import { type Deserializer, type Serializer } from '../lib/algebraic_type';
import type { ConnectionId } from '../lib/connection_id';
import { Identity } from '../lib/identity';
import type { ParamsObj, ReducerCtx } from '../lib/reducers';
import { type UntypedSchemaDef } from '../lib/schema';
import { Timestamp } from '../lib/timestamp';
import { type Infer, type InferTypeOfRow, type TypeBuilder } from '../lib/type_builders';
import { Uuid } from '../lib/uuid';
import { type HttpClient } from './http_internal';
import type { DbView } from './db_view';
import { type Random } from './rng';
import { type ModuleExport, type SchemaInner } from './schema';
export type ProcedureExport<S extends UntypedSchemaDef, Params extends ParamsObj, Ret extends TypeBuilder<any, any>> = ProcedureFn<S, Params, Ret> & ModuleExport;
export declare function makeProcedureExport<S extends UntypedSchemaDef, Params extends ParamsObj, Ret extends TypeBuilder<any, any>>(ctx: SchemaInner, opts: ProcedureOpts | undefined, params: Params, ret: Ret, fn: ProcedureFn<S, Params, Ret>): ProcedureExport<S, Params, Ret>;
export type ProcedureFn<S extends UntypedSchemaDef, Params extends ParamsObj, Ret extends TypeBuilder<any, any>> = (ctx: ProcedureCtx<S>, args: InferTypeOfRow<Params>) => Infer<Ret>;
export interface ProcedureOpts {
    name: string;
}
export interface ProcedureCtx<S extends UntypedSchemaDef> {
    readonly sender: Identity;
    readonly identity: Identity;
    readonly timestamp: Timestamp;
    readonly connectionId: ConnectionId | null;
    readonly http: HttpClient;
    readonly random: Random;
    withTx<T>(body: (ctx: TransactionCtx<S>) => T): T;
    newUuidV4(): Uuid;
    newUuidV7(): Uuid;
}
export interface TransactionCtx<S extends UntypedSchemaDef> extends ReducerCtx<S> {
}
export type Procedures = Array<{
    fn: ProcedureFn<any, any, any>;
    deserializeArgs: Deserializer<any>;
    serializeReturn: Serializer<any>;
    returnTypeBaseSize: number;
}>;
export declare function callProcedure(moduleCtx: SchemaInner, id: number, sender: Identity, connectionId: ConnectionId | null, timestamp: Timestamp, argsBuf: Uint8Array, dbView: () => DbView<any>): Uint8Array;
//# sourceMappingURL=procedures.d.ts.map